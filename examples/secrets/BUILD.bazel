load("@com_adobe_rules_gitops//gitops:defs.bzl", "k8s_deploy")

[
    k8s_deploy(
        name = ENV + "-server",
        cluster = CLUSTER,
        configmaps_renaming = "hash",
        images = {
            "helloworld-image": "//helloworld:image",
        },
        manifests = glob(["*.yaml"]),
        namespace = ENV,
        secrets_srcs = glob([ENV + "/secrets/**/*"]),
    )
    for (ENV, CLUSTER) in [
        ("it", "it-cluster"),
        ("mynamespace", "dev-cluster"),
    ]
]
